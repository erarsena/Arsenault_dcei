---
title: "Patterns of climate change in the USA: an analysis of temperature and precipitation trends since 1950"
author: Emily Arsenault, Department of Ecology & Evolutionary Biology, University of Kansas, Lawrence, Kansas 66047 USA
output: pdf_document
fontsize: 12pt
bibliography: datacarpentry.bib
csl: science.csl
---
<!--Chunk for reproducibility checkpoint-->
```{r checkpoint, echo=F, include=F}
#install.packages("checkpoint")
library(checkpoint)
checkpoint("2018-03-01")
```

<!--Chunk for importing the data-->
```{r import, include=F, echo=F, cache=T}

##### MODULARITY 8: RECORDING DEPENDENCIES AND OUTPUTS FOR EACH CHUNK #####
## Dependencies of chunk: external script "ACISimport.R" and/or files "USAAnnualTemp1950_2016.rds" and "USAAnnualPcpn1950_2016.rds"

##### MODULARITY 7: WRITE PSEUDOCODE #####
#if the file exists (TRUE)
  #read it in
#if the file does not exists (FALSE)
  #use func in external script to download data from the web and create this file

##### MODULARITY 9: USING EXTERNAL SCRIPT #####
source("ACISimport.R") #function for pulling climate data from web

##### MODULARITY 2: WRITING EXTENSIBLE CODE #####
data.temp <- "USAAnnualTemp1950_2008.rds"
data.pcpn <- "USAAnnualPcpn1950_2008.rds"
data.temp.web <- "USAannualTemp1950_2016.rds"

acis.pcpn <- readRDS(data.pcpn)

provided <- FALSE
if(provided) {
  acis.temp <- readRDS(data.temp)
} else if(file.exists(data.temp.web)) {
  acis.temp <- readRDS(data.temp.web)
} else {
  acis.temp <- acis2df(sdate = "19500101", edate = "20161231", states = state.abb)
}

#making the function work
#break into 2 30-year chunks instead of 1 60 year
##or, use bounding box instead of states?
#otherwise, using too much RAM


#test
min(acis.temp$year) #start year, 1950
max(acis.temp$year) #end year, 2016
min(acis.pcpn$year) #start year, 1950
max(acis.pcpn$year) #end year, 2008

#Outputs: variable for rds data files (acis.temp; acis.pcpn) imported, loaded into R, and saved to directory as variables
```

<!--Chunk for cleaning the data-->
```{r cleaning, include=F}

#Dependencies: imported dataset (temp)

#Pseudocode
#set variable for minimum number of years needed to include weather station
#use aggregate function to find length (years) for each weather station
#if the number of rows for the weather station is less than 40, give NA value to year
#na.omit

#install.packages("plyr")

#remove any weather station with less than 40 years of data
minyears <- 40 #minimum number of years needed to use weather station in subsequent analyses
acis.temp.stn <- aggregate(year ~ variable + lat + lon + state, data = na.omit(acis.temp), FUN = length)
acis.temp.stn$variable[acis.temp.stn$year<minyears] <- NA
# get your new data.frame
newdf <- na.omit(data.frame(year=acis.temp.stn$year, variable=rep(acis.temp.stn$variable, sapply(acis.temp.stn$variable, length))))
stations <- newdf$variable #all of the variable names that we want
newstations <- na.omit(acis.temp)[is.element(na.omit(acis.temp)$variable, stations),] #this is the cleaned data set finally omg I am going to die

#for each "variable" in acis.temp.stn
#count the number of rows
#if rows < 40
#replace years column with NAs

#change data format to matrix
#dim() check dimensions of matrix
library(reshape2)
matrix.temp <- na.omit(acast(newstations, variable~year, value.var="value"))

#Outputs: cleaned up dataset (tempclean)

```

<!--Chunk for data analysis-->
```{r analysis, include=F}

#Dependencies: imported, cleaned dataset (matrix.temp)

##### MODULARITY 1:GIVING VARIABLE NAMES TO CONSTANTS #####

#use apply function to calculate mean temp for each year

#Outputs: mintemp1950, mintemp2016, maxtemp1950, maxtemp2016, maxtemp1950sp, maxtemp2016sp, meantemp1950, meantemp2016, side effect plot of temperature averages by year
```

<!--Chunk for making the map-->
```{r map, include=F}
library(maps)
#install.packages("mapdata")
library(mapdata)
#install.packages("RColorBrewer")
library(RColorBrewer)
library(classInt)

map(database = "state")
plotvar <- newstations$value
nclr <- 8
plotclr <- brewer.pal(nclr,"PuOr")
plotclr <- plotclr[nclr:1] # reorder colors
class <- classIntervals(plotvar, nclr, style="equal")
colcode <- findColours(class, plotclr)
points(acis.temp$lon, acis.temp$lat, pch=16, col=colcode, cex=2)
points(acis.temp$lon, acis.temp$lat, cex=2)
title("USA Annual Temperature 1950",
    sub="Equal-Interval Class Intervals")
legend(-117, 44, legend=names(attr(colcode, "table")),
    fill=attr(colcode, "palette"), cex=0.6, bty="n")
```

## Abstract

- Applied Climate Information System database (ACIS)
- parameters included :

## Introduction

Periods of warming and cooling are natural phenomena throughout the history of the earth. However, evidence suggests that the unprecedented climate changes occuring over the last century have been a result of anthropogenic increases in carbon dioxide to the atmopshere. Here, we provide evidence to support climate warming in the United States based on patterns of temperature and precipitation. The objectives of this study were to (1) determine whether or not the United States has expereinced climate warming since 1950, (2) highlight key areas of the United States that have exeperienced the greatest changes in average annual temperature, and (3) determine the degree to which precipitation has changed in the United States over the last century.

## Methods

Temperature and precipitation datasets were pulled from the Applied Climate Information System (ACIS) database @Hubbard2004. The temperature dataset includes yearly average temperature data gathered from weather stations located all over the USA, between the years of `r min(acis.temp$year)` and `r max(acis.temp$year)`. The precipitation dataset includes annual average rainfall measurements at weather stations all across the USA, measured between the years of __ and __.

## Results

- figure  
- map

## Discussion

## References
